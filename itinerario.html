<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Itinerario Semanal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#2f3bff;
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#1e293b;
  --muted:#94a3b8;
}

body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-bottom:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.05);
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid #e5e7eb;
  padding:6px;
  vertical-align:top;
  font-size:13px;
}

th{
  background:#eef2ff;
}

button,input{
  padding:6px;
  border-radius:6px;
  border:1px solid #e5e7eb;
}

button{
  background:var(--primary);
  color:white;
  border:none;
  cursor:pointer;
  margin-top:4px;
}

.activity{
  background:#f1f5ff;
  border-radius:6px;
  padding:4px;
  margin:4px 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}
</style>
</head>

<body>

<div class="card">
  <button onclick="location.href='calendario.html'">â¬… Volver</button>
</div>

<div class="card">
  <h3>Crear nueva semana</h3>
  <input id="tituloSemana" placeholder="TÃ­tulo de la semana">
  <button onclick="crearSemana()">Crear semana</button>
</div>

<div id="semanas"></div>

<script>
const dias = ["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"];

const getS = () => JSON.parse(localStorage.getItem("semanas")) || [];
const saveS = s => localStorage.setItem("semanas", JSON.stringify(s));

function crearSemana(){
  if(!tituloSemana.value.trim()) return;

  const s = getS();
  s.push({
    id: crypto.randomUUID(),
    titulo: tituloSemana.value.trim(),
    actividades: {}
  });

  saveS(s);
  tituloSemana.value="";
  renderSemanas();
}

function renderSemanas(){
  semanas.innerHTML="";
  const s = getS();

  s.forEach(sem=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
  <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
    <h3>${sem.titulo}</h3>
    <div>
      <button onclick="verSemana('${sem.id}')">ðŸ‘€</button>
      <button onclick="eliminarSemana('${sem.id}')">ðŸ—‘</button>
    </div>
  </div>
`;


    const table=document.createElement("table");

    const head=document.createElement("tr");
    dias.forEach(d=>head.innerHTML+=`<th>${d}</th>`);
    table.appendChild(head);

    const row=document.createElement("tr");

    dias.forEach(d=>{
      const td=document.createElement("td");

      const acts=(sem.actividades[d]||[])
        .sort((a,b)=>a.hora.localeCompare(b.hora));

      acts.forEach(a=>{
        const divA=document.createElement("div");
        divA.className="activity";
        divA.innerHTML=`
          <span><strong>${a.hora}</strong> ${a.texto}</span>
          <button onclick="delAct('${sem.id}','${d}','${a.id}')">ðŸ—‘</button>
        `;
        td.appendChild(divA);
      });

      td.innerHTML+=`
        <input type="time" id="h-${sem.id}-${d}">
        <input placeholder="Actividad" id="t-${sem.id}-${d}">
        <button onclick="addAct('${sem.id}','${d}')">+</button>
      `;

      row.appendChild(td);
    });

    table.appendChild(row);
    div.appendChild(table);
    semanas.appendChild(div);
  });
}

function addAct(sid,d){
  const h=document.getElementById(`h-${sid}-${d}`).value;
  const t=document.getElementById(`t-${sid}-${d}`).value;

  if(!h || !t.trim()) return;

  const s=getS();
  const sem=s.find(x=>x.id===sid);

  sem.actividades[d]=sem.actividades[d]||[];
  sem.actividades[d].push({
    id:crypto.randomUUID(),
    hora:h,
    texto:t.trim()
  });

  saveS(s);
  renderSemanas();
}

function delAct(sid,d,aid){
  const s=getS();
  const sem=s.find(x=>x.id===sid);

  sem.actividades[d]=sem.actividades[d].filter(a=>a.id!==aid);

  saveS(s);
  renderSemanas();
}



renderSemanas();

function eliminarSemana(id){
  if(!confirm("Â¿Eliminar esta semana?")) return;
  const s = getS().filter(x => x.id !== id);
  saveS(s);
  renderSemanas();
}

function verSemana(id){
  location.href = `vista.html?id=${id}`;
}

</script>

</body>
</html>
